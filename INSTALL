I n s t a l l i n g  S - n a i l
================================

Compilation
-----------

System specific notes can be found in the next section.
Any (optional) feature is adjustable and documented in `conf.rc'.
Adjustments may also take place, and are usually done, from the command
line, overriding those made in `conf.rc' (if any):

  $ [make &&] make install
  $ make uninstall          # Won't remove the system wide startup file!
  $ make distclean          # *Completely* cleanup working directory

With adjustments:

  $ make WANT_AUTOCC=1 WANT_IMAP=0 install
  $ make WANT_AUTOCC=1 WANT_NCL=0 PREFIX=/some/nasty/prefix install

There are also some predefined restricted configuration sets available,
which take precedence over anything else:

. CONFIG=MINIMAL
  little is left but some air to breathe; no internet connectivity, no
  internationalized domain names, no command line editor, no
  documentation strings.

. CONFIG=MEDIUM
  Like MINIMAL, but with documentation strings, and the builtin command
  line editor will be included if that is possible.

. CONFIG=NETSEND
  WANT_SMTP and WANT_SSL settings are enabled, internationalized domain
  names will be supported if the necessary libraries are available,
  otherwise identical to MEDIUM.

E.g.:

  $ make CONFIG=MINIMAL WANT_AUTOCC=1 DESTDIR=xtest install

would create a `s-nail' binary and install a `s-nail' manual etc.
under the prefix `/usr/local' but rooted under [./]`xtest', i.e., the
binary would be installed as `[./]xtest/usr/local/bin/s-nail'.

The `WANT_AUTOCC=1' switch allows the S-nail(1) build system to not only
detect, but also adjust CFLAGS and LDFLAGS settings -- if you want to
add specific locale additions, use `ADDCFLAGS=' and `ADDLDFLAGS=', e.g.

  $ make WANT_AUTOCC=1 ADDCFLAGS=-pipe ADDLDFLAGS="-Wl,-O1,--sort-common"

By default it doesn't dare to overwrite CFLAGS and LDFLAGS, because it
cannot distinguish where the value comes from, a general user
environment or a specific command line overwrite, making use cases like

  $ make CFLAGS='-O1 -g -pipe'

impossible.  The following make(1) target exists, and note that you can
use a VERBOSE=1 command line option to gain more (or a different kind
of) verbosity:

. all         Create / check and update configuration, build.
. install     Create / check and update configuration, build, install.
. clean       Remove anything which can be rebuild.
. distclean   Remove anything which can be rebuild or reconfigured.
. uninstall   Uninstall (if configured).

. config      Only create or check and update the configuration.
. build       Only build (using the existing configuration).
. test        Run ./cc-test.sh in --check-only mode on the built binary.
. packager-install
              Only install using the built files of the existing
              configuration.  It is possible to overwrite DESTDIR= when
              using this target nonetheless (a following `uninstall'
              won't know about that overwritten value, however).

If some libraries are missing that you know are installed on your
system, or if other errors occur due to missing files but which you know
exist, please ensure that the environment variable `C_INCLUDE_PATH'
includes the necessary `include/' paths and the environment variable
`LD_LIBRARY_PATH' includes the necessary `lib/'rary paths.

The S-nail make system will inspect these two environment variables and
*automatically* convert them to cc(1) (c99(1)) -I and -L options (since
these environment variables are, different to the command line options,
not part of the POSIX standard).
To set these environment variables, the following can be done in
a Bourne/Korn/POSIX compatible shell:

  $ C_INCLUDE_PATH="${C_INCLUDE_PATH}:/usr/local/include"
  $ LD_LIBRARY_PATH="${LD_LIBRARY_PATH}:/usr/local/lib"
  $ export C_INCLUDE_PATH LD_LIBRARY_PATH
  $ make WANT_AUTOCC=1 install

The S-nail make system will also automatically integrate pkgsrc(7) paths
into this mechanism.  pkgsrc(7) is used to handle building (compilation),
installation and removal of software packages on a lot of operating
systems, including all BSD systems, Linux, Solaris ...

Notes for S-nail(1) v14.5*
--------------------------

S-nail(1) has been or is used regulary on these systems (`uname -srm').
Note first that MAILSPOOL is by default `/var/mail' (see `conf.rc').

Also, i'm (compile) testing manually with WANT_AUTOCC=1, WANT_DEBUG=[01]
and WANT_AMALGAMATION=[01] (and WANT_GSSAPI=1), which is what is
reflected by the following statements.

. All 32-bit systems:
  - There _may_ be warnings about format strings, like, e.g.,

      auxlily.c:1610:10: warning: format '%lu' expects type 'long
      unsigned int', but argument 3 has type 'size_t'

    This is ugly, but it has been decided to keep the S-nail codebase
    ISO C89 compatible, which means that there are no usable language
    hints for format strings.  However, `nail.h' tries hard to detect
    the real type sizes and ends up in a way that should ensure that the
    actually expected datatype is of the same size in reality:

/* XXX Note we don't really deal with that the right way in that we pass size_t
 * XXX arguments without casting; should do, because above we assert UINT_MAX
 * XXX is indeed ui32_t */
#if defined __STDC_VERSION__ && __STDC_VERSION__ + 0 >= 199901L
# define ZFMT           "zu"
#elif defined SIZE_MAX && SIZE_MAX == 0xFFFFFFFFu && ULONG_MAX != UINT_MAX
# define ZFMT           "u"
#endif
#ifndef ZFMT
# define ZFMT           "lu"
#endif

. Mac OS X <https://www.apple.com/>
  (Snow Leopard) Darwin 10.8.0 Darwin Kernel Version 10.8.0: Tue Jun
  7 16:33:36 PDT 2011; root:xnu-1504.15.3~1/RELEASE_I386 i386.
  - gcc-mp-4.8 (MacPorts gcc48 4.8.2_0) 4.8.2.
    + Note: with WANT_AMALGAMATION there is a single warning on 'signed
      overflow'.  I think it's wrong.
  - clang version 3.4 (branches/release_34 197314)
    Target: x86_64-apple-darwin10.8.0
    Thread model: posix.
  - i686-apple-darwin10-gcc-4.2.1 (GCC) 4.2.1 (Apple Inc. build 5666)
    (dot 3).
  - Apple clang version 1.7 (tags/Apple/clang-77) (based on LLVM
    2.9svn).

. ArchLinux <https://www.archlinux.org/>
  Linux 3.12.6-1-ARCH x86_64
  - gcc (GCC) 4.8.2 20131219 (prerelease)
    + Note: warnings on unused results, just ignore (for now).

. NetBSD <https://www.netbsd.org/>
  NetBSD 6.99.28 NetBSD 6.99.28 (GENERIC) #0: Fri Jan  3 05:24:46 UTC
  2014 i386
  - gcc (NetBSD nb1 20120916) 4.5.4
    + Warnings on format strings -- as above.
    + Note: i think faulty message on longjmp() clobbering (on
      a variable that is 'const').
    + Note: with WANT_AMALGAMATION there are many warnings on 'signed
      overflow', all referring to the same code, and i think it's wrong.

  NetBSD 6.99.24 NetBSD 6.99.24 (GENERIC) #0: Tue Oct 29 08:23:21 UTC
  2013 amd64.
  - gcc (NetBSD nb1 20120916) 4.5.4.
    + Note: i think faulty message on longjmp() clobbering (on
      a variable that is 'const'.
    + Note: with WANT_AMALGAMATION there are many warnings on 'signed
      overflow', all referring to the same code, and i think it's wrong.

. CRUX Linux <http://www.crux.nu/>
  Linux 3.6.11 #1 SMP Sun Sep 15 17:47:31 UTC 2013 x86_64.
  - gcc (CRUX-x86_64-multilib) 4.7.2.
    + Note: there is a single warning on 'signed overflow'.  I think it's
      wrong.

. OpenBSD <http://www.openbsd.org/>
  OpenBSD 5.4 i386.
  - gcc (GCC) 4.2.1 20070719.

. FreeBSD <https://www.freebsd.org/>
  FreeBSD 10.0-CURRENT amd64.
  - FreeBSD clang version 3.3 (tags/RELEASE_33/final 183502) 20130610
    Target: x86_64-unknown-freebsd10.0
    Thread model: posix.

. Void Linux <http://www.voidlinux.eu/>
  Linux 3.10.19_1 i686.
  - gcc (GCC) 4.7.3.
    + Note: there is a single warning on 'signed overflow'.  I think it's
      wrong.

. DragonFly BSD <https://www.dragonflybsd.org/>
  DragonFly 3.6-RELEASE x86_64
  - gcc 4.7.3 [DragonFly] Release/2013-04-11.
    + Note: harmless iconv(3) warning again (as if we didn't had to treat it
      specially already).
    + Note: there is a single warning on 'signed overflow'.  I think it's
      wrong.

. UnixWare 7.1.4.
  + Note: this make(1) requires the -e option to pass values to make(1)
    subprocesses, so, if you want to overwrite DESTDIR= when doing
    `packager-install', you better say '$ make -e DESTDIR=xy ...'.
  + You'll see some harmless and ignorable warnings.

. Slackware Linux <http://www.slackware.com/>
  Slackware 14 3.2.29-smp (i386).
  + Note: not tested for v14.5, machine disappeared.  (Will install a VM
    with the new release before the next minor.)
  - gcc (GCC) 4.7.1.
  - clang version 3.0 (tags/RELEASE_30/final).

OpenIndiana is targeted for v14.6.
And i'm very interested in reports from other combinations.
(It should work practically everywhere, generally speaking.)

Program features yet to be overhauled
-------------------------------------

Since i've forked Heirloom mailx(1) (for real) as S-nail(1) on
2012-09-18 i make my way through the codebase, but have not yet taken
a look (rather: at all) into the following modules/parts:

  [List view/threading], Maildir, SSL, IMAP, POP3, SMTP, GSSAPI, Caching

These will remain features of S-nail(1) and they will be looked at, and
of course i will fix bugs when i notice them, but they are not yet part
of the overhauled "S-nail core" (though SMTP and POP are in daily use,
and IMAP is slowly coming along).

I'll hope to be able to release S-nail v20 on 2018-03-25, the 40th
anniversary of Mail, as a good one, then.  Also see `TODO'.

vim:set fenc=utf-8:s-ts-mode
